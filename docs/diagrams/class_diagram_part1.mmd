%% Class diagram â€” Part 1: Services & Models
%% Generated: 2025-11-07
%% Purpose: show Supabase-backed service layer and core data shapes (Cart, Orders, Menu, Student)

classDiagram

    class SupabaseService {
        - SupabaseClient _client
        + Future<List<Map<String,dynamic>>> getRestaurants()
        + Future<List<Map<String,dynamic>>> getMenuItems(int restaurantId)
        + Future<Map<String,dynamic>?> getRestaurantEffectiveIsOpen(int restaurantId)
        + Future<Map<String,dynamic>?> createOrder(String studentId, int restaurantId, double totalAmount, List<Map> cartItems)
        + Future<List<Map<String,dynamic>>> getStudentOrders(String studentId)
        + Future<List<Map<String,dynamic>>> getStudentActiveOrders(String studentId)
        + Future<List<Map<String,dynamic>>> getCompletedAndCancelledOrders(String studentId)
        + Future<bool> updateOrderStatus(int orderId, String newStatus)
        + Future<bool> cancelOrder(int orderId, String reason)
        + Future<String?> uploadMenuImage(String filePath, int restaurantId)
        + Future<String?> uploadPaymentSlip(String filePath, int orderId)
        + Future<bool> updateOrderWithSlip(int orderId, String slipUrl)
        + RealtimeChannel setupStudentOrdersSubscription(String studentId, Function onOrderUpdate)
        + RealtimeChannel setupOrdersRealtimeSubscription(int restaurantId, Function onNewOrder)
    }

    class CartService {
        - List<Map<String,dynamic>> _cartItems
        - ValueNotifier<int> cartUpdateNotifier
        + List<Map<String,dynamic>> get cartItems
        + int get totalItems
        + double get totalAmount
        + void addToCart(Map<String,dynamic> menuItem, String restaurantId, String restaurantName)
        + void removeFromCart(int index)
        + void increaseQuantity(int index)
        + void decreaseQuantity(int index)
        + void clearCart()
        + void updateSpecialRequest(int index, String request)
        + // singleton access: CartService()
    }

    %% Core data shapes
    class StudentUser {
        + String userId
        + String studentId
        + String firstName
        + String lastName
        + String email
        + String phoneNumber
        + String profileImage
        + String faculty
        + String department
        + int year
        + String university
        + DateTime joinDate
        + int loyaltyPoints
        + List<String> favoriteRestaurants
        + List<Map<String,dynamic>> orderHistory
        + Map<String,dynamic> preferences
        + String fullName()
        + Map<String,dynamic> toJson()
    }

    class CartItem {
        + String studentId
        + dynamic itemId
        + String restaurantName
        + String restaurantId
        + String imgUrl
        + String foodname
        + double price
        + int quantity
        + String specialRequest
        + List<Map<String,dynamic>> addOns
    }

    class MenuItem {
        + int id
        + String name
        + double price
        + String image_url
        + String category
        + int restaurant_id
    }

    class Order {
        + int id
        + String student_id
        + int restaurant_id
        + String restaurant_name
        + double total_amount
        + int total_items
        + String status
        + String? payment_slip_url
        + String? cancellation_reason
        + DateTime? created_at
        + DateTime? updated_at
        + DateTime? completed_at
        + List<OrderItem> items
    }

    class OrderItem {
        + int id
        + int order_id
        + String food_name
        + double price
        + int quantity
        + String? special_request
    }

    %% Associations
    SupabaseService ..> MenuItem : "fetches/creates/updates"
    SupabaseService ..> Order : "creates/queries/updates"
    SupabaseService ..> OrderItem : "reads/writes"
    SupabaseService ..> StudentUser : "reads/updates profile"

    CartService o-- CartItem : "contains"
    CartItem --> MenuItem : "based on"
    CartService ..> SupabaseService : "calls createOrder(get cartItems)"

    StudentUser <-- SupabaseService : "getStudentProfile() returns student map"
