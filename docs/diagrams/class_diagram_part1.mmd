%% Class diagram â€” Part 1: Services & Models
%% Generated: 2025-11-07
%% Purpose: show Supabase-backed service layer and core data shapes (Cart, Orders, Menu, Student)

classDiagram

    class SupabaseService {
        - SupabaseClient _client
        + Future<List<Map<String,dynamic>>> getRestaurants()
        + Future<List<Map<String,dynamic>>> getMenuItems(int restaurantId)
        + Future<Map<String,dynamic>?> createOrder(String studentId, int restaurantId, double totalAmount, List<Map> cartItems)
        + Future<Map<String,dynamic>?> getOrderById(int orderId)
        + Future<Map<String,dynamic>?> getStudentProfile(String studentId)
        + Future<bool> updateOrderStatus(int orderId, String newStatus)
        + Future<String?> uploadPaymentSlip(String filePath, int orderId)
        + RealtimeChannel setupOrdersRealtimeSubscription(int restaurantId, Function onNewOrder)
    }

    class CartService {
        - List<Map<String,dynamic>> _cartItems
        + List<Map<String,dynamic>> get cartItems
        + int get totalItems
        + double get totalAmount
        + String? get currentRestaurantId
        + bool hasItemsFromDifferentRestaurant(String restaurantId)
        + void addToCart(Map<String,dynamic> menuItem, String restaurantId, String restaurantName)
        + void removeFromCart(int index)
        + void clearCart()
    }

    %% Core data shapes
    class StudentUser {
        + String userId
        + String studentId
        + String fullName
        + String email
        + String? phoneNumber
        + String? profileImage
        + bool isStudentVerified
        + Map<String,dynamic> toJson()
    }

    class CartItem {
        + dynamic itemId
        + String restaurantId
        + String restaurantName
        + String foodname
        + double price
        + int quantity
        + List<Map<String,dynamic>> addOns
    }

    class MenuItem {
        + int id
        + String name
        + double price
        + String? image_url
        + String category
    }

    class Order {
        + int id
        + String student_id
        + int restaurant_id
        + double total_amount
        + int total_items
        + String status
        + String? payment_slip_url
        + DateTime? created_at
        + List<OrderItem> items
    }

    class OrderItem {
        + int id
        + int order_id
        + String food_name
        + double price
        + int quantity
    }

    %% Associations
    SupabaseService ..> MenuItem : "fetches/creates/updates"
    SupabaseService ..> Order : "creates/queries/updates"
    SupabaseService ..> OrderItem : "reads/writes"
    SupabaseService ..> StudentUser : "reads/updates profile"

    CartService o-- CartItem : "contains"
    CartItem --> MenuItem : "based on"
    CartService ..> SupabaseService : "calls createOrder(get cartItems)"

    StudentUser <-- SupabaseService : "getStudentProfile() returns student map"
